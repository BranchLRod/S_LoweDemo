var MenuSearchDrawerComponentNew=function(n,t){function i(i){var r=this,u;r.element=i;r.$element=n(i);u=r.$element.find('[data-ref="menu-search-drawer-result-template"]').html();r.template=t.compile(u);r.xhr=null;r.analyticFoodSearchZeroTimeout=null;r.analyticFoodSearchTimeout=null;r.sendingAnalyticTimeout=1500}return i.prototype.Init=function(){var t=this;t.$element.find("form").on("submit",function(i){i.preventDefault();var r=n(this).attr("action"),u=t._serialize(this,!0);u&&(r+="?"+u);window.location.href=r});t.$element.find("[data-ref=searchTerm]").on("keyup",function(n){n.preventDefault();t._refreshAnalyticAttributes();t._autocomplete()})},i.prototype._autocomplete=function(){var t=this,i=t.$element.data("action-url"),r=t._getSearchTermValue();if(i+="?q="+r,t.xhr&&t.xhr.readyState!==4&&t.xhr.abort(),r.length<3){t.$element.find("[data-ref=results]").html("");return}t.xhr=n.ajax({url:i,method:"GET"}).done(function(n){var r=t.template(n),i=t.$element.find("[data-ref=total-results]"),u;t.$element.find("[data-ref=results]").html(r);n.data.length>0?(t._sendAnalytic(),n.data.length<t.$element.data("count")?(u=n.data.length!==1?i.attr("data-total-plural"):i.attr("data-total-singular"),i.html(n.data.length+" "+u)):i.html(i.attr("data-total-more"))):(t._sendAnalyticZeroResults(),i.html(r))}).fail(function(n){console.log(n)})},i.prototype._getSearchTermValue=function(){var i=this,n="",t=i.$element.find("[data-ref=searchTerm]");return t.length&&(n=t.val()),encodeURIComponent(n)},i.prototype._sendAnalytic=function(){var t=this;t.analyticFoodSearchTimeout&&(clearTimeout(t.analyticFoodSearchTimeout),t.analyticFoodSearchTimeout=null);t.analyticFoodSearchTimeout=setTimeout(function(){var i=t._getSearchTermValue();i.length<3||n(document).trigger("gatracking:autocomplete:foodSearch",[i])},t.sendingAnalyticTimeout)},i.prototype._sendAnalyticZeroResults=function(){var t=this;t.analyticFoodSearchZeroTimeout&&(clearTimeout(t.analyticFoodSearchZeroTimeout),t.analyticFoodSearchZeroTimeout=null);t.analyticFoodSearchZeroTimeout=setTimeout(function(){var i=t._getSearchTermValue();n(document).trigger("gatracking:autocomplete:foodSearchZero",[i])},t.sendingAnalyticTimeout)},i.prototype._refreshAnalyticAttributes=function(){var n=this,t=n._getSearchTermValue();n.$element.find("[data-ref=submit]").attr("data-foodSeachTerm",t)},i.prototype._serialize=function(n){var t=[];return n.querySelectorAll("[name]").forEach(function(n){t.push(n.name+"="+encodeURIComponent(encodeURI(n.value)))}),t.join("&")},i}(jQuery,Handlebars);$(function(){$("body").find("[data-component=menu-search-drawer-new]").each(function(){var n=new MenuSearchDrawerComponentNew(this);n.Init()})})